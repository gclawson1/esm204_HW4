---
title: "Homework 4"
author: "Gage Clawson, Juan Silva"
date: "5/31/2019"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(janitor)
library(stargazer)
```

```{r, include=FALSE}
#read in data
carbon <- read_csv("HW4Data.csv") %>%
  clean_names()
```

1. Write down a plausible functional form for the marginal cost of abatement for sector A. Use regression analysis to estimate the parameters of that function. Repeating this for sectors B, C, and D will give you a model of the marginal cost of abatement function for each sector. How well do your models fit the data for each sector? You may need to experiment with different functional forms. Produce a plot of the estimated marginal abatement cost functions in all four sectors (this plot should go in your memo).

```{r, include = FALSE}
carbon_tidy <- gather(carbon, sector, mc, mc_a:mc_d) %>%
  mutate(sector = case_when(
    sector == "mc_a" ~ "Sector A",
    sector == "mc_b" ~ "Sector B",
    sector == "mc_c" ~ "Sector C",
    sector == "mc_d" ~ "Sector D"
  ))

#use regression to define functions for marginal cost of abatement
lm_a <- lm(data = carbon, mc_a ~ abatement) 
summary(lm_a)
# mc_a = -8.64448 + 0.57684*abatement

lm_b <- lm(data = carbon, mc_b ~ abatement) 
summary(lm_b)
# mc_b = 9.31770 + 0.19874*abatement

lm_c <- lm(data = carbon, mc_c ~ abatement) 
summary(lm_c)
# mc_c = -11.65503 + 0.78383*abatement

lm_d <- lm(data = carbon, mc_d ~ abatement) 
summary(lm_d)
# mc_d = 9.68751 + 0.25993*abatement

```


```{r, echo = FALSE}
stargazer(lm_a, lm_b, lm_c, lm_d, type="text", title="Table 1: Regression Results")
```


```{r, echo = FALSE}
## plot all the data and corresponding regression lines. ggplot one is better IMO
ggplot(data = carbon_tidy, aes(x=abatement, y = mc)) + geom_point() +
  geom_smooth(method="lm", se = FALSE) +
  facet_wrap(~sector, scales = "free") +
  theme_bw() +
  labs(x = "Abatement (tons)", y = "Marginal Cost", title = "Estimated Marginal Abatement Cost Functions") 


```

Marginal Cost of Abatement Functions: 
$$MC_A= -8.65 + 0.58(Abatement)$$
$$MC_B= 9.32 + 0.2 (Abatement)$$
$$MC_C = -11.66 + 0.78 (Abatement)$$
$$MC_D = 9.69 + 0.26 (Abatement)$$

2. Using these models and the current level of carbon emissions, derive each sector’s demand curve for carbon emissions. In other words, how much would each sector be willing to pay for the right to pollute the first unit, second unit, etc? Draw these demand curves on a graph. Which sector is willing to pay the most for the first unit of carbon emissions?

```{r, include = FALSE}
#calculate the y intercept by plugging in emissions to linear regression models

sector_A_y <- lm_a$coefficients[2]*180 + lm_a$coefficients[1]
sector_B_y <- lm_b$coefficients[2]*200 + lm_b$coefficients[1]
sector_C_y <- lm_c$coefficients[2]*220 + lm_c$coefficients[1]
sector_D_y <- lm_d$coefficients[2]*300 + lm_d$coefficients[1]


#define the demand curves for each sector 
slope_A <- -sector_A_y/180 
demand_A <- function(x) {
  slope_A*x + sector_A_y
  
}


slope_B <- -sector_B_y/200
demand_B <- function(x) {
  slope_B*x + sector_B_y
  
}

slope_C <- -sector_C_y/220
demand_C <- function(x) {
  slope_C*x + sector_C_y
  
}

slope_D <- -sector_D_y/300
demand_D <- function(x) {
  slope_D*x + sector_D_y
  
}


carbon_demand <-  carbon %>%
  mutate(demandA = demand_A(x = abatement)) %>% 
  mutate(demandB = demand_B(x = abatement)) %>% 
  mutate(demandC = demand_C(x = abatement)) %>%
  mutate(demandD = demand_D(x = abatement))
```

```{r, echo = FALSE}

#ggplot(carbon_demand) +
#  geom_smooth(aes(abatement,demandA), method=lm, se=FALSE, color = "red") +
#  geom_smooth(aes(abatement,demandB), method=lm, se=FALSE, color = "blue") +
#  geom_smooth(aes(abatement,demandC), method=lm, se=FALSE, color = "green") +
#  geom_smooth(aes(abatement,demandD), method=lm, se=FALSE, color = "orange")
  

carbon_demand_tidy <- carbon_demand %>%
  select(-mc_a, -mc_b, - mc_c, -mc_d) %>%
  gather(sector, demand, demandA:demandD)%>%
    mutate(sector = case_when(
    sector == "demandA" ~ "Sector A",
    sector == "demandB" ~ "Sector B",
    sector == "demandC" ~ "Sector C",
    sector == "demandD" ~ "Sector D"
  ))

ggplot(data = carbon_demand_tidy, aes(x=abatement, y = demand)) + 
  geom_smooth(method="lm", se = FALSE) +
  facet_wrap(~sector, scales = "free") +
  theme_bw() +
  labs(x = "Carbon Emissions (tons)", y = "Price per ton", title = "Estimated Demand Curves for Carbon Emissions") 




```

Demand for emission functions:
$$Demand_A = -0.529(Emissions) + 95.2 $$
$$Demand_B = -0.245(Emissions) + 49.1 $$
$$Demand_C =-0.731(Emissions) + 160.8 $$
$$Demand_D = -0.292 (Emissions)+ 87.67 $$

 - Sector C is willing to pay the most for the first unit of carbon emissions. 
 
 3. Now focus on country X (which contains sectors A, B, and C). Assume there are no “co-benefits” from carbon abatement (i.e. that there are no local pollutants that are affected by carbon abatement). Suppose to meet the Paris Accord commitments, country X needs to cut all carbon emissions in half. For each of the policy options listed below, derive: (1) the total cost of meeting the target in country X, (2) the cost (or benefit) to each sector, and (3) the tax revenue generated.
  a. Cap on carbon. Each sector (A, B, and C) must cut its carbon emissions by 100 tons (thus reducing total emissions from 600 down to 300).
  b. Tax on carbon. To emit a ton of carbon in country X, you must pay a tax of $t. You will need to find the tax that accomplishes the desired reduction.
  c. Cap and trade. Each sector (A, B, C) is allocated carbon permits equal to their current emissions minus 100 (same as in (a) above), thus achieving the total reduction of 300. Then, these three sectors are allowed to trade with each other. You will need to derive the outcome of that trading.

#3. 
#a. Cap on carbon: 300 tons in Country x total 
 - We calculated the lost benefits to each sector using the demand functions previously described by finding the area under each of those curves until 100. 
 
```{r, include = FALSE}
#part a 

abate<-c(100, 100, 100, 300)

MCa <- demand_A(100)
MCb <- demand_B(100)
MCc <- demand_C(100)

MC <- rbind(MCa, MCb, MCc, NA)

costa <- integrate(demand_A, 0, 100)
costa <- costa$value
costb <- integrate(demand_B, 0, 100)
costb <- costb$value
costc <- integrate(demand_C, 0, 100)
costc <- costc$value
totalcost <- sum(costa, costb, costc)

cost <- rbind(costa, costb, costc, totalcost)

parta<- cbind(abate, MC, cost)
colnames(parta)=c("Units abated","Marginal cost", "Cost")
row.names(parta)=c("Sector A", "Sector B", "Sector C", "Total Country X")
parta
```

```{r, echo=FALSE}
round(parta, 0)
```


$$Abatement_{ag} = 600 - 7.335*MC$$
$$MC_{ag} = 81.8 - 0.136*Abatement$$

$$Abatement_A = 180 - 1.89*MC$$
$$Abatement_B = 200 - 2.08*MC$$

$$Abatement_C = 220 - 1.37*MC$$

```{r, include = FALSE}
##calculations for finding the above formulas: 
em_A <- -sector_A_y/slope_A
em_B <- -sector_B_y/slope_B
em_C <- -sector_C_y/slope_C

abate_ag_y <- em_A + em_B + em_C


abate_slope_ag <- 1/slope_A + 1/slope_B + 1/slope_C

mc_ag_y = -abate_ag_y/abate_slope_ag

mc_slope_ag <- 1/abate_slope_ag

```


```{r, include = FALSE}
#tax problem
MC<- mc_ag_y + mc_slope_ag*300

a <- 180
b <- 200
c <- 220 

abatea <- (sector_A_y - MC)/-slope_A
abateb<-(sector_B_y-MC)/-slope_B
abatec<-(sector_C_y-MC)/-slope_C
totalabate<-sum(abatea, abateb, abatec)

abate<-rbind(abatea, abateb, abatec, totalabate)

taxa<-abatea*MC
taxb<-abateb*MC
taxc<-abatec*MC
totaltax<-sum(taxa, taxb, taxc)

tax<-rbind(taxa, taxb, taxc, totaltax)

costa<-MC*(a-abatea)*0.5
costb<-MC*(b-abateb)*0.5
costc<-MC*(c-abatec)*0.5
totalcost<-sum(costa, costb, costc)

cost<-rbind(costa, costb, costc, totalcost)
  

partb<- cbind(abate, cost,tax)
colnames(partb)=c("Units abated", "Cost","Tax")
row.names(partb)=c("Sector A", "Sector B", "Sector C", "Total Country X")
partb
```

```{r, echo=FALSE}
round(partb,0)
```




